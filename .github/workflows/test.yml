name: Git Training Lab Tests

on:
  push:
    branches: [ main, 'feature/**', 'my-exercise-**' ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest
    
    - name: Run tests
      continue-on-error: true
      run: |
        pytest tests/ -v --tb=line 2>&1 | tee test_output.txt
    
    - name: Generate Progress Report
      if: always()
      run: |
        echo ""
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘           ðŸŽ“ GIT TRAINING LAB - PROGRESS REPORT ðŸŽ“            â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        
        # Count passed and failed
        PASSED=$(grep -c "PASSED" test_output.txt 2>/dev/null || echo "0")
        FAILED=$(grep -c "FAILED" test_output.txt 2>/dev/null || echo "0")
        TOTAL=$((PASSED + FAILED))
        
        echo "ðŸ“Š Overall: $PASSED / $TOTAL tests passing"
        echo ""
        
        # Function to check exercise status
        check_exercise() {
          local name="$1"
          local label="$2"
          local pass_count=$(grep "Test${name}.*PASSED" test_output.txt 2>/dev/null | wc -l)
          local total_count=$(grep "Test${name}::" test_output.txt 2>/dev/null | wc -l)
          
          if [ "$pass_count" -eq "$total_count" ] && [ "$total_count" -gt 0 ]; then
            printf "âœ… %-35s - COMPLETE (%d/%d)\n" "$label" "$pass_count" "$total_count"
          else
            printf "â¬œ %-35s - %d/%d passing\n" "$label" "$pass_count" "$total_count"
          fi
        }
        
        check_exercise "Exercise1" "Exercise 1 (Reverse String)"
        check_exercise "Exercise2" "Exercise 2 (FizzBuzz)"
        check_exercise "Exercise3" "Exercise 3 (Find Max)"
        check_exercise "Exercise4" "Exercise 4 (Count Vowels)"
        check_exercise "Exercise5" "Exercise 5 (Palindrome)"
        check_exercise "Exercise6" "Exercise 6 (Two Sum)"
        check_exercise "Exercise7" "Exercise 7 (Merge Arrays)"
        check_exercise "Exercise8" "Exercise 8 (Group Anagrams)"
        check_exercise "Exercise9" "Exercise 9 (Valid Parentheses)"
        
        echo ""
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        
        if [ "$PASSED" -eq "$TOTAL" ] && [ "$TOTAL" -gt 0 ]; then
          echo "ðŸŽ‰ CONGRATULATIONS! All exercises complete!"
        else
          echo "ðŸ’ª Keep going! Complete the exercises marked with â¬œ"
          echo ""
          echo "Tip: Failing tests are expected until you implement the solutions!"
        fi
        echo ""